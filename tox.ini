[tox]
skipsdist = true
envlist = py314, lint, type
requires =
    tox>=4.31
    tox-uv>=1.29.0

[gh-actions]
python =
    3.14: py314
    3.15: py315

[testenv]
passenv = PYTHON_VERSION
runner = uv-venv-lock-runner
allowlist_externals = uv
commands =
    pytest --doctest-modules tests --cov --cov-config=pyproject.toml --cov-report=xml
    mypy

[testenv:fix]
description = format + autofix (ruff)
runner = uv-venv-lock-runner
package = skip
commands =
    ruff format src/python_try ./tests
    ruff check --fix src/python_try ./tests

[testenv:lint]
description = lint (ruff + pylint)
runner = uv-venv-lock-runner
package = skip
commands =
    ruff check ./python_try ./tests

[testenv:type]
description = type check (mypy)
runner = uv-venv-lock-runner
package = skip
commands =
    mypy src/python_try tests

[testenv:docs]
description = build docs
runner = uv-venv-lock-runner
package = skip
dependency_groups =
    docs
commands =
    mkdocs build

[testenv:docs-test]
description = build docs (strict)
runner = uv-venv-lock-runner
# Keep the project importable inside tox's isolated env so mkdocstrings can resolve python_try in CI.
package = editable
dependency_groups =
    docs
commands =
    mkdocs build -s

[testenv:build]
description = build wheel/sdist via uv
runner = uv-venv-lock-runner
package = skip
dependency_groups =
    dev
    test
    docs
allowlist_externals = uv
commands =
    uv build --out-dir dist/

[testenv:outdated]
description = show outdated packages in tox env
runner = uv-venv-lock-runner
package = skip
dependency_groups =
    dev
    test
    docs
allowlist_externals = uv
commands =
    uv lock --upgrade --dry-run
